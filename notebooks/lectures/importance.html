<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="In the lectures so far, we have been using a notation for random variables where the RV is capitalized and (regular) variables ranging over values are lower case, so X=x. In general, this is uncommon in the statistics literature and you are more likely to see expressions like this:" property="og:description"><meta content="Statistics Notation" property="og:title"><meta content="article:clerk" property="og:type"><meta content="summary_large_image" name="twitter:card"><script src="https://cdn.tailwindcss.com?plugins=typography" type="text/javascript"></script><script>tailwind.config = {
  darkMode: "class",
  content: ["./tw/viewer.js", "./tw/**/*.edn"],
  safelist: ['dark'],
  theme: {
    extend: {},
    fontFamily: {
      sans: ["Fira Sans", "-apple-system", "BlinkMacSystemFont", "sans-serif"],
      serif: ["PT Serif", "serif"],
      mono: ["Fira Mono", "monospace"]
    }
  },
  variants: {
    extend: {},
  },
  plugins: [],
}
</script><style type="text/tailwindcss">@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    font-size: 18px;
  }
  @media (max-width: 600px) {
    html {
      font-size: 16px;
    }
  }
  .font-condensed { font-family: "Fira Sans Condensed", sans-serif; }
  .font-inter     { font-family: "Inter", sans-serif; }
  body {
    @apply font-serif antialiased text-gray-900 sm:overscroll-y-none;
  }
  code, .code {
    @apply font-mono text-sm text-gray-900 bg-slate-50 px-0.5 py-px rounded dark:bg-gray-800;
  }
  code::before, code::after { @apply content-none !important; }
  h1, h3, h4, h5, h6 {
    @apply font-condensed font-bold mt-8 first:mt-0;
  }
  h2 {
    /*We cannot collapse margins due to nesting but we want to*/
    /*keep the h2’s large margin visible*/
    @apply font-condensed font-bold mt-8 first:mt-2;
  }
  h1 { @apply text-4xl; }
  h2 { @apply text-3xl; }
  h3 { @apply text-2xl; }

  @media print {
      h1 { @apply text-2xl !important; }
      h2 { @apply text-xl !important; }
      h3 { @apply text-lg !important; }
  }

  button { @apply focus:outline-none; }
  strong { @apply font-bold; }
  em     { @apply italic; }
  pre    { @apply m-0 font-mono; }
  table img { @apply inline-block; }
}

/* Compatibility */
/* --------------------------------------------------------------- */
/* TODO: Verify which colors are in use and replace with Tailwind
   colors accordingly. Move Nj-specific styles out of here. */

:root {
  --teal-color: #31afd0;
  --dark-teal-color: #095960;
  --near-black-color: #2e2e2c;
  --red-color: #d64242;
  --dark-blue-color: #1f2937;
  --dark-blue-60-color: rgba(28, 42, 56, 0.6);
  --gray-panel-color: rgba(239, 241, 245, 1.000);
  --brand-color: var(--dark-blue-color);
  --link-color: #5046e4;
  --command-bar-selected-color: var(--teal-color);
}

.serif      { @apply font-serif; }
.sans-serif { @apply font-sans; }
.monospace  { @apply font-mono; }
.inter      { @apply font-inter; }

.border-color-teal { border-color: var(--dark-teal-color); }
.teal { color: var(--teal-color); }
.bg-dark-blue { background: var(--dark-blue-color); }
.bg-dark-blue-60 { background: rgba(28, 42, 56, 0.6); }
.bg-gray-panel { background: var(--gray-panel-color); }
.text-dark-blue  { color: var(--dark-blue-color); }
.text-dark-blue-60 { color: var(--dark-blue-60-color); }
.border-dark-blue-30 { border-color: rgba(28, 42, 56, 0.6); }
.text-brand { color: var(--dark-blue-color); }
.bg-brand { background: var(--dark-blue-color); }
.text-selected { color: white; }
.red { color: var(--red-color); }

/* Disclose Button */
/* --------------------------------------------------------------- */

.disclose {
  @apply content-none border-solid cursor-pointer inline-block relative mr-[3px] top-[-2px] transition-all;
  border-color: var(--near-black-color) transparent;
  border-width: 6px 4px 0;
}
.disclose:hover {
  border-color: var(--near-black-color) transparent;
}
.dark .disclose,
.dark .disclose:hover {
  border-color: white transparent;
}
.disclose.collapsed {
  @apply rotate-[-90deg];
}

/* Layout */
/* --------------------------------------------------------------- */

.page {
  @apply max-w-5xl mx-auto px-12 box-border flex-shrink-0;
}
.max-w-prose { @apply max-w-[46rem] !important; }
.max-w-wide  { @apply max-w-3xl !important; }

/* List Styles */
/* --------------------------------------------------------------- */

.task-list-item + .task-list-item,
.markdown-viewer ul ul {
  @apply mt-1 mb-0;
}

/* compact TOC */
.markdown-viewer .toc ul {
  list-style: none;
  @apply my-1;
}

/* Code Viewer */
/* --------------------------------------------------------------- */

.code-viewer {
  @apply font-mono bg-slate-100 rounded-sm text-sm overflow-x-auto dark:bg-gray-800;
}
.code-listing  {
    @apply -ml-8 -mr-8 relative !important;
}
.code-viewer .cm-content {
  @apply py-4 px-8;
}
@media (min-width: 960px){
    .notebook-viewer .code-viewer .cm-content {
        @apply pl-12;
    }
    .notebook-viewer .code-listing {
        width: 48rem !important;
        @apply -ml-12 mr-0 !important;
    }
}
/* Don’t show focus outline when double-clicking cell in Safari */
.cm-scroller { @apply focus:outline-none; }

/* Syntax Highlighting */
/* --------------------------------------------------------------- */

.inspected-value { @apply text-xs font-mono leading-[1.25rem]; }
.cmt-strong, .cmt-heading { @apply font-bold; }
.cmt-italic, .cmt-emphasis { @apply italic; }
.cmt-strikethrough { @apply line-through; }
.cmt-link { @apply underline; }
.untyped-value { @apply whitespace-nowrap; }

.cm-editor, .cmt-default, .result-viewer {
  @apply text-slate-800 dark:text-slate-300;
}
.cmt-keyword {
  @apply text-purple-800 dark:text-pink-400;
}
.cmt-atom, .cmt-bool, .cmt-url, .cmt-contentSeparator, .cmt-labelName {
  @apply text-blue-900 dark:text-blue-300;
}
.cmt-inserted, .cmt-literal {
  @apply text-emerald-700 dark:text-emerald-200;
}
.cmt-string, .cmt-deleted {
  @apply text-rose-700 dark:text-sky-300;
}
.cmt-italic.cmt-string {
  @apply dark:text-sky-200;
}
.cmt-regexp, .cmt-escape {
  @apply text-orange-500 dark:text-orange-300;
}
.cmt-variableName {
  @apply text-blue-800 dark:text-sky-300;
}
.cmt-typeName, .cmt-namespace {
  @apply text-emerald-600 dark:text-emerald-300;
}
.cmt-className {
  @apply text-teal-600 dark:text-teal-200;
}
.cmt-macroName {
  @apply text-teal-700 dark:text-teal-200;
}
.cmt-propertyName {
  @apply text-blue-700 dark:text-blue-200;
}
.cmt-comment {
  @apply text-slate-500 dark:text-slate-400;
}
.cmt-meta {
  @apply text-slate-600 dark:text-slate-400;
}
.cmt-invalid {
  @apply text-red-500 dark:text-red-300;
}

.result-data {
  @apply font-mono text-sm overflow-x-auto whitespace-nowrap leading-normal;
}
.result-data::-webkit-scrollbar, .path-nav::-webkit-scrollbar {
  @apply h-0;
}
.result-data-collapsed {
  @apply whitespace-nowrap;
}
.result-data-field {
  @apply ml-4 whitespace-nowrap;
}
.result-data-field-link{
  @apply ml-4 whitespace-nowrap cursor-pointer;
}
.result-data-field-link:hover {
  @apply text-black bg-black/5;
}
.result-text-empty {
  color: rgba(0,0,0,.3);
}
.browsify-button:hover {
  box-shadow: -2px 0 0 2px #edf2f7;
}

/* Prose */
/* --------------------------------------------------------------- */

.notebook-viewer,
.markdown-viewer {
  @apply prose
    dark:prose-invert
    prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline
    dark:prose-a:text-blue-300
    prose-p:mt-4 prose-p:leading-snug
    prose-ol:mt-4 prose-ol:mb-6 prose-ol:leading-snug
    prose-ul:mt-4 prose-ul:mb-6 prose-ul:leading-snug
    prose-blockquote:mt-4 prose-blockquote:leading-snug
    prose-hr:mt-6 prose-hr:border-t-2 prose-hr:border-solid prose-hr:border-slate-200
    prose-figure:mt-4
    prose-figcaption:mt-2 prose-figcaption:text-xs
    prose-headings:mb-4
    prose-table:mt-0
    prose-th:mb-0
    prose-img:my-0
    prose-code:font-medium prose-code:bg-slate-100
    max-w-none;
}
.markdown-viewer blockquote p:first-of-type:before,
.markdown-viewer blockquote p:last-of-type:after {
  @apply content-none;
}
.markdown-node-viewer.result-viewer.fragment-item {
    @apply mb-0 !important;
}

/* Images */
/* --------------------------------------------------------------- */


/* Todo Lists */
/* --------------------------------------------------------------- */

.contains-task-list {
  @apply pl-6 list-none;
}
.contains-task-list input[type="checkbox"] {
  @apply appearance-none h-4 w-4 rounded border border-slate-200 relative mr-[0.3rem] ml-[-1.5rem] top-[0.15rem];
}
.contains-task-list input[type="checkbox"]:checked {
  @apply border-indigo-600 bg-indigo-600 bg-no-repeat bg-contain;
  background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
}

/* Markdown TOC */
/* --------------------------------------------------------------- */

.markdown-viewer .toc      { @apply mt-4; }
.markdown-viewer h1 + .toc { @apply mt-8; }

.markdown-viewer .toc h1,
.markdown-viewer .toc h2,
.markdown-viewer .toc h3,
.markdown-viewer .toc h4,
.markdown-viewer .toc h5,
.markdown-viewer .toc h6 {
  @apply text-base text-indigo-600 font-sans my-0;
}
.markdown-viewer .toc a {
  @apply text-indigo-600 font-normal no-underline hover:underline;
}
.markdown-viewer .toc li    { @apply m-0; }
.markdown-viewer .toc ul ul { @apply pl-4; }

/* Notebook Spacing */
/* --------------------------------------------------------------- */

.markdown-viewer *:first-child:not(.code-viewer):not(li):not(h2):not(.sidenote) { @apply mt-0; }
/*.viewer + .viewer { @apply mt-6; }*/
.viewer + .result-viewer { @apply mt-0; }
.code-viewer + .result-viewer { @apply mt-3; }
.markdown-viewer + .markdown-viewer { @apply mt-0; }

/* Sidenotes */
/* --------------------------------------------------------------- */

.sidenote-ref {
  @apply top-[-0.5em] w-auto h-auto inline border-0 bg-transparent m-0 pointer-events-none;
}
.sidenote {
  @apply block font-sans text-xs mt-4 bg-slate-100 dark:bg-slate-800 p-4;
  font-style: normal;
  font-weight: normal;
}
.sidenote-container {
  @apply mb-4;
}
@media (min-width: 860px) {
  .sidenote sup { @apply inline; }
  .sidenote-column {
    @apply w-[165px] absolute right-0 top-0 -mr-[205px];
  }
  .sidenote {
    @apply bg-transparent dark:bg-transparent p-0;
  }
  .sidenote:first-child {
    @apply mt-1;
  }
  .sidenotes-layout .markdown-viewer {
    @apply pr-[241px];
  }
  .sidenote-container {
    @apply relative mb-0;
  }
  .sidenotes-layout h1 {
    @apply w-[756px] !important;
  }
}
.code-viewer + .viewer:not(.code-viewer):not(.code-viewer-folded),
.code-viewer-folded + .viewer:not(.code-viewer):not(.code-viewer-folded),
.result-viewer:not(.markdown-node-viewer) + .result-viewer {
  @apply mt-2;
}
.code-viewer + .code-viewer-folded {
  @apply mt-4;
}
.result-viewer {
  @apply leading-tight mb-6;
}
.code-viewer.fragment-item.result-viewer {
  @apply mb-0 !important;
}
.result-viewer figure {
  @apply mt-0 !important;
}
@media (min-width: 768px) {
  .devcard-desc > div {
    @apply max-w-full m-0;
  }
}

/* Command Palette */
/* --------------------------------------------------------------- */

.nj-commands-input {
  @apply bg-transparent text-white;
}
.nj-context-menu-item:hover:not([disabled]) {
  @apply cursor-pointer;
  background-color: rgba(255,255,255,.14);
}

/* Devdocs */
/* --------------------------------------------------------------- */

.logo, .logo-white {
  @apply block indent-[-999em];
  background: url(/images/nextjournal-logo.svg) center center no-repeat;
}
.devdocs-body {
  @apply font-inter;
}

/* Workarounds */
/* --------------------------------------------------------------- */

/* Fixes vega viewer resizing into infinity */
.vega-embed .chart-wrapper { @apply h-auto !important; }
/* fixes fraction separators being overridden by tw’s border-color */
.katex * { @apply border-black; }

@media print {
    .dark-mode-toggle,
    .toc-toggle { @apply hidden; }
    .notebook-viewer { @apply pt-0; font-size: 12pt !important; margin-left: 0 !important; }
    .code-viewer .cm-content,
    .viewer-code .cm-content { @apply whitespace-pre-wrap !important; overflow: none; }
    .code-viewer .cm-line { font-size: 12pt !important; }
    html * { page-break-inside: avoid !important; }
    .toc-panel { @apply hidden; }
}
</style><script src="https://cas.clerk.garden/tree/8VxCcd2nQqrhPLVttyyM5Rnv8qMYcjeSEjgJnhZTvCgVhmgsNWWeusxmVkfX9ajrXmFqQEdVmtdHSoCdHLG2XTsXXB/.clerk/shadow-cljs/main.js" type="module"></script><link href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.bunny.net" rel="preconnect"><link href="https://fonts.bunny.net/css?family=fira-mono:400,700%7Cfira-sans:400,400i,500,500i,700,700i%7Cfira-sans-condensed:700,700i%7Cpt-serif:400,400i,700,700i" rel="stylesheet" type="text/css"></head><body class="dark:bg-gray-900"><div id="clerk"></div><script type="module">let viewer = nextjournal.clerk.sci_env
let state = "{:bundle? false, :path->doc {\"notebooks/lectures/importance.clj\" {:path [], :nextjournal/value {:toc [{:title \"Statistics Notation\", :emoji nil, :path \"#statistics-notation\", :items []}], :sidenotes? false, :atom-var-name->state #viewer-eval (nextjournal.clerk.render/intern-atoms! {}), :ns #viewer-eval (ns user), :file \"notebooks/lectures/importance.clj\", :bundle? false, :header {:path [], :nextjournal/value [:div.viewer.w-full.max-w-prose.px-8.not-prose.mt-3 [:div.mb-8.text-xs.sans-serif.text-slate-400 nil [:<> [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href \"./../../\"} \"Index\"] [:span.mx-2 \"•\"]] [:span \"Generated with \" [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href \"https://clerk.vision\"} \"Clerk\"] \" from \" [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href \"https://github.com/sritchie/tim-class/blob/573ebd011b9e427199a1f35ba3858ca43f9b7243/notebooks/lectures/importance.clj\"} \"notebooks/lectures/importance.clj\" [:<> \"@\" [:span.tabular-nums \"573ebd0\"]]]]]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}, :open-graph {:type \"article:clerk\", :title \"Statistics Notation\", :description \"In the lectures so far, we have been using a notation for random variables where the RV is capitalized and (regular) variables ranging over values are lower case, so X=x. In general, this is uncommon in the statistics literature and you are more likely to see expressions like this:\"}, :title \"Statistics Notation\", :blocks [{:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"user/markdown-5drS52iqmwKWuJufpdQudLwPbHwFDq\"} [\"h1\" {:id \"statistics-notation\"} [:<> \"Statistics Notation\"]] [:p [:<> \"In the lectures so far, we have been using a notation for random variables\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"where the RV is capitalized and (regular) variables ranging over values are\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"lower case, so \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"X=x\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \". In general, this is uncommon in the statistics\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"literature and you are more likely to see expressions like this:\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(z\\\\mid x) = \\\\frac{p(x\\\\mid z)p(z)}{p(x)}.\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"In this case, we are assuming that \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is a density and that \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"x\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" and \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"z\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" are\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"variables with range over values of the random variables \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"Z\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" and \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"X\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \", though\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"typically the latter are left implicit and never mentioned explicitly.\"]] [:p [:<> \"In general, from now on in the course, we will adopt this convention.\"]] [:p [:<> \"Furthermore, we adopt the convention that \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"z\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" ranges over tuples of values\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"for our \"] [:em [:<> \"latent\"]] [:<> \" random variables, while \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"x\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" range over tuples of values of\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"our \"] [:em [:<> \"observed\"]] [:<> \" random variables. When we wish to emphasize that our observed\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"are fixed at some particular values (for instance when we are doing\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"inference) we will use a breve like this \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\breve{x}\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \".\"]] [:ul [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"z\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" represents our \"] [:strong [:<> \"latent\"]] [:<> \" random variables.\"]]] [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"x\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" represents our \"] [:strong [:<> \"observed\"]] [:<> \" random variables.\"]]] [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\breve{x}\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" represents our \"] [:strong [:<> \"observed\"]] [:<> \" random variables fixed at some particular value.\"]]] [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x,z)=p(x\\\\mid z)p(z)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" represents our \"] [:strong [:<> \"joint distribution\"]] [:<> \" (as a generative model) where.\"]]] [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x\\\\mid z)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is the \"] [:strong [:<> \"likelihood\"]] [:<> \" and\"]]] [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(z)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is the \"] [:strong [:<> \"prior\"]] [:<> \".\"]]] [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(z\\\\mid x) = \\\\frac{p(x,z)}{p(x)}\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is our \"] [:strong [:<> \"posterior\"]] [:<> \".\"]]] [:li [:<> [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x) = \\\\int p(x,z) dz\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is the \"] [:strong [:<> \"marginal likelihood\"]] [:<> \" of the observed random variables.\"]]]] [\"h2\" {:id \"another-view-of-rejection-sampling:-drawing-from-a-proposal-and-\\\"reweighting\\\"\"} [:<> \"Another view of Rejection Sampling: Drawing from a Proposal and \\\"Reweighting\\\"\"]] [:p [:<> \"Sampling is a useful because it allows us to approximately represent complex\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"probability distributions by finite sets of samples from the distribution.\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"For example, if we draw \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"K\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" samples from a random variable \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"X\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" we can use\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"these to approximate arbitrary expectations against \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"X\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \", by the law of large\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"numbers.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\mathbb{E}_{x \\\\sim p} [f(x)]   \\\\approx \\\\frac{1}{K} \\\\sum_{i=1}^{K} f(\\\\hat{x}_i), \\\\quad \\\\hat{x}_i \\\\sim p(x)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"However, as we have seen it is not always possible to efficiently draw exact\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"samples from our target distribution \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \".\"]] [:blockquote [:p [:<> \"What is the central example in this course of a kind of distribution that it is not easy to efficiently draw exact samples from?\"]]] [:p [:<> \"Rejection sampling is the first example of many algorithm that we will see\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"that takes a different approach: draw samples from an alternative \"] [:em [:<> \"proposal\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"distribution \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q(x)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" and then reweight the samples to \\\"correct\\\" them to the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"target distribution \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" with \\\"correction weight function\\\" \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"w(x)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \".\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\mathbb{E}_{x \\\\sim p} [f(x)]  \\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} w(\\\\hat{x}_i)} \\\\sum_{i=1}^{K} w(\\\\hat{x}_i) f(\\\\hat{x}_i), \\\\quad \\\\hat{x}_i \\\\sim q(x)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"If we can sample directly from \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"X \\\\sim p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \", then the standard law of large\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"numbers approximation can be thought of as using a weight function which is\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"constant and equal to \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"1\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \", that is \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"w(\\\\cdot)=1\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \". However, when we draw from\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"another distribution \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q(x)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \", \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"w(x)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" needs to be a weighting function\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"that \\\"upweights\\\" samples that are less probable under \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" than they would be\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"under \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" and \\\"downweights\\\" samples that more probable under \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" than they\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"would be under \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \".\"]] [:p [:<> \"In rejection sampling the proposal distribution was the joint distribution\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"while the target is the posterior we are trying to approximate. In rejection\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"sampling, we can think of our weights as simply an indicator function that\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"returns whether the condition holds in the sample.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)] \\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\mathbb{1}_{\\\\breve{x}}(\\\\hat{x}_i)} \\\\sum_{i=1}^{K}  \\\\mathbb{1}_{\\\\breve{x}}(\\\\hat{x}_i) f(\\\\hat{z}_i), \\\\quad \\\\hat{x}_i, \\\\hat{z}_i \\\\sim p(x, z)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"In other words, for rejection sampling, our weight function is always either\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"0\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" or \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"1\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" depending on whether the sample matched the conditioner exactly.\"]] [:blockquote [:p [:<> \"Can you think of other possible weight functions?\"]]] [\"h2\" {:id \"exact-sampling\"} [:<> \"Exact Sampling\"]] [:p [:<> \"When a sampler returns samples at a rate which is exactly proportional to the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"target density \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \", we say that it is an \"] [:em [:<> \"exact\"]] [:<> \" sampler. Rejection sampling,\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"though slow, is an exact sampler? However, in what follows we will see our\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"first cases of another class of sampling algorithms that make use of\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:em [:<> \"approximate samplers\"]] [:<> \". Let's turn to our first example.\"]] [\"h1\" {:id \"likelihood-weighting\"} [:<> \"Likelihood Weighting\"]] [:p [:<> \"The problem with rejection sampling, we have seen, is that it you may have to\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"wait a long time to draw a sample that satisfies the conditioner. As the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"marginal likelihood of the conditioner becomes smaller, the time you may have\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"to wait becomes very large. Can we do better than this?\"]] [:p [:<> \"One thing to note in our implementation of rejection sampling is that even\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"though we know the condition, we do not make use of this information in any\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"way during generation of the sample. We simply guess and check.\"]] [:p [:<> \"One obvious idea is that we might, instead, simply \"] [:strong [:<> \"force\"]] [:<> \" the relevant\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"observations to take on their constrained values and only sample the latent\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"variables in the model? This algorithm is known as \"] [:em [:<> \"likelihood\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"weighting\"]] [:<> \" (for reasons we will see shortly).\"]] [:p [:<> \"And let's look at ourbiased coin model again.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:div.code-viewer.code-listing [#viewer-eval nextjournal.clerk.render/inspect-presented {:path [0], :nextjournal/value \"@gen function flip_biased_coin(N)\\n    θ ~ beta(1,1)\\n\\n    [{:x => i} ~ bernoulli(θ)  for i in 1:N]\\nend;\", :nextjournal/render-opts {:language \"julia\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code, :hash \"5dsJQw12yyyd7TcZEf52VSHxnqnJUC\"}}]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:p [:<> \"In Gen, the \"] [:code [:<> \"generate\"]] [:<> \" function implements likelihood weighting. It is called\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"in a way similar to \"] [:code [:<> \"simulate\"]] [:<> \" but with an extra argument representing the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"constraints to be enforced (implemented as a choice map).\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:div.code-viewer.code-listing [#viewer-eval nextjournal.clerk.render/inspect-presented {:path [0], :nextjournal/value \"observations = Gen.choicemap()\\n\\nobservations[:x=>1]=true\\nobservations[:x=>2]=true\\n(t, w) = Gen.generate(flip_biased_coin,(3,),observations)\\nGen.get_choices(t)\", :nextjournal/render-opts {:language \"julia\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code, :hash \"5dsJQw12yyyd7TcZEf52VSHxnqnJUC\"}}]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:p [:<> \"In terms of the graphical model, the likelihood weighting algorithm\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"simply \\\"forces\\\" all shaded nodes to their constrained value and only samples\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"the latent variable nodes.\"]] [:p] [:blockquote [:p [:<> \"What condition must be met for likelihood weighting to work?\"]]] [:p [:<> \"Note that \"] [:code [:<> \"generate\"]] [:<> \" also returns an extra return value, a \"] [:em [:<> \"weight\"]] [:<> \", which we\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"will talk about shortly.\"]] [:p [:<> \"If we substitute \"] [:code [:<> \"generate\"]] [:<> \" into our rejection sampling code where we\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"formerly used \"] [:code [:<> \"simulate\"]] [:<> \" what will happen.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:div.code-viewer.code-listing [#viewer-eval nextjournal.clerk.render/inspect-presented {:path [0], :nextjournal/value \"function iter_deep(c::Gen.ChoiceMap)\\n  Iterators.flatten([\\n      Gen.get_values_shallow(c),\\n      (Dict(Pair{Any, Any}(k => kk, vv) for (kk, vv) in iter_deep(v))\\n       for (k, v) in Gen.get_submaps_shallow(c))...,\\n  ])\\nend\\n\\nfunction check_conditions(trace, constraints)\\n    for (name, value) in iter_deep(constraints)\\n        if trace[name] != value return false end\\n    end\\n    return true\\nend\\n\\nfunction rejection(generative_model, arguments, constraints)\\n    (t,w)=Gen.generate(generative_model,arguments,constraints)\\n    if check_conditions(t,constraints)\\n        print(\\\"Matched constraint.\\\")\\n        return(t)\\n    else\\n        print(\\\"Failed to match constraint.\\\")\\n        rejection(generative_model, arguments, constraints)\\n    end\\nend\\n\\nobservations = Gen.choicemap()\\n\\nfor i in 1:10000\\n    observations[:x => i] = true\\nend\\n\\nvalid_trace=rejection(flip_biased_coin, (10010,), observations);\\nGen.get_choices(valid_trace);\", :nextjournal/render-opts {:language \"julia\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code, :hash \"5dsJQw12yyyd7TcZEf52VSHxnqnJUC\"}}]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:p [:<> \"we didn't need to call this in a recursive loop anymore at all, since we match the constraint \"] [:em [:<> \"every\"]] [:<> \" time.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:div.code-viewer.code-listing [#viewer-eval nextjournal.clerk.render/inspect-presented {:path [0], :nextjournal/value \"observations = Gen.choicemap()\\n\\nfor i in 1:10000\\n    observations[:x => i] = true\\nend\\n\\n(valid_trace, weight)=Gen.generate(flip_biased_coin, (10010,), observations);\\nGen.get_choices(valid_trace);\", :nextjournal/render-opts {:language \"julia\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code, :hash \"5dsJQw12yyyd7TcZEf52VSHxnqnJUC\"}}]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:p [:<> \"But now we have a different problem, let's examine the distribution of values of the sampled \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\theta\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" parameter.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:div.code-viewer.code-listing [#viewer-eval nextjournal.clerk.render/inspect-presented {:path [0], :nextjournal/value \"observations = Gen.choicemap()\\n\\nfor i in 1:1000\\n    observations[:x => i] = true\\nend\\n\\nhistogram([Gen.generate(flip_biased_coin, (1001,),\\n            observations)[1][:θ] for _ in 1:10000])\", :nextjournal/render-opts {:language \"julia\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code, :hash \"5dsJQw12yyyd7TcZEf52VSHxnqnJUC\"}}]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:p [:<> \"Our \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\theta\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" parameter is still following its prior distribution of a \"] [:code [:<> \"beta(1,1)\"]] [:<> \".\"]] [:blockquote [:p [:<> \"Why is this distribution still following the prior?\"]]] [\"h2\" {:id \"weighted-samples\"} [:<> \"Weighted Samples\"]] [:p [:<> \"We saw above how simply forcing the observed random variables to take on\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"their constrained values obviously significantly speeds up our sampling\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"algorithm. However, we have a significant problem now. We saw at the end of\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"the last chapter why rejection sampling was a correct sampling algorithm. The\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"algorithm relied on the fact that our target conditional distribution has\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"probability proportional to the joint distribution. By throwing away samples\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"that didn't satisfy the conditioner, we implicitly normalized the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"distribution on the subset of states in the joint that satisfied the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"conditioner.\"]] [:p [:<> \"However, likelihood weighting no longer satisfies this contract. In\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"particular, when it is possible, the algorithm always returns every sample.\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"Intuitively, many samples from our latent random variables may not be \\\"good\\\"\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"in the sense that they choose values which generate the observed variables\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"with low probability. Moreover, likelihood weighting draws latent random\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"variable values according to the \"] [:strong [:<> \"prior\"]] [:<> \" rather than the posterior.\"]] [:p [:<> \"For example, in the biased coin model, likelihood weighting will draw\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\theta\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" from a \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\mathrm{beta}(1,1)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" distribution, even when we observe ten\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"thousand \"] [:code [:<> \"true\"]] [:<> \" flips as above. In this case, the true posterior over\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\theta\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" should be steeply peaked near \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"1\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" and, thus, most of our draws from\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\mathrm{beta}(1,1)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" will lead to very low probabilities for the observed\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"variables.\"]] [:p [:<> \"So why is this useful at all? This is where the weight we mentioned above\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"comes in.\"]] [:p [:<> \"In likelihood weighting, we reweight our samples by the likelihood of the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"observed variables, that is by the probability of the observed variables\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"given the sampled values of the latent variables.\"]] [:p [:<> \"Thus, in the example above, if we draw a low \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\theta\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" this will assign a very\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"low weight to the sample since it generates the condition with low\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"probability.\"]] [:p [:<> \"We can represent likelihood weighting mathematically as follows.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\mathbb{E}_{p(z\\\\mid x)} [f(z)]  \\\\approx  \\\\frac{1}{\\\\sum_{i=1}^{K} p(x \\\\mid \\\\hat{z}_i)} \\\\sum_{i=1}^{K}  p(x \\\\mid \\\\hat{z}_i) f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:div.code-viewer.code-listing [#viewer-eval nextjournal.clerk.render/inspect-presented {:path [0], :nextjournal/value \"num_flips=5\\nobservations = Gen.choicemap()\\n\\nfor i in 1:(num_flips-1)\\n    observations[:x => i] = true\\nend\\n\\nfunction weighted_sample()\\n    (t,w) = Gen.generate(flip_biased_coin, (num_flips,), observations)\\n    [t[:θ],exp(w)]\\nend\\n\\nsamples=[weighted_sample() for _ in 1:10000]\\n\\nthetas = [item[1] for item in samples]\\nweights = [item[2] for item in samples]\\n\\nhistogram(thetas, weights=weights)\", :nextjournal/render-opts {:language \"julia\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code, :hash \"5dsJQw12yyyd7TcZEf52VSHxnqnJUC\"}}]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [\"h1\" {:id \"importance-sampling\"} [:<> \"Importance Sampling\"]] [:p [:<> \"Likelihood weighting is a special case of a more general weighting method\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"known as \"] [:em [:<> \"importance sampling\"]] [:<> \". In importance sampling, we draw from $Y \\\\sim\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"q$ and reweight each sample according to the \"] [:em [:<> \"normalized importance function\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"w(z) = \\\\frac{p(z\\\\mid \\\\breve{x})}{q(z)}\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \". In other words, we compute our\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"expectations according to the following formula.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\mathbb{E}_{p(z \\\\mid \\\\breve{x})} [f(z)]  \\\\approx  \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\hat{z}_i \\\\mid \\\\breve{x})}{q(\\\\hat{z}_i)}} \\\\sum_{i=1}^{K}  \\\\frac{p(\\\\hat{z}_i \\\\mid \\\\breve{x})}{q(\\\\hat{z}_i)} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q(z)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"Why does this work?\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\begin{aligned}\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)] &= \\\\sum_{z} p(z\\\\mid \\\\breve{x}) f(z)\\\\\\\\\\n                              &= \\\\sum_{z} q(z) \\\\frac{p(z\\\\mid \\\\breve{x})}{q(z)}f(z)\\\\\\\\\\n                              &= \\\\sum_{z} q(z) g(z), \\\\quad g(z) = w(z)f(z) = \\\\frac{p(z\\\\mid \\\\breve{x})}{q(z)}f(z)\\\\\\\\\\n                              &=  \\\\mathbb{E}_{q(z)} [g(z)]\\\\\\\\\\n                              &\\\\approx  \\\\frac{1}{K}\\\\sum_{i=1}^{K} g(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q(z)\\\\\\\\\\n                              &\\\\approx  \\\\frac{1}{K}\\\\sum_{i=1}^{K}w(\\\\hat{z}_i)f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q(z)\\\\\\\\\\n                              &\\\\approx  \\\\frac{1}{K}\\\\sum_{i=1}^{K}\\\\frac{p(\\\\hat{z}_i \\\\mid \\\\breve{x})}{q(\\\\hat{z}_i)} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q(z)\\\\\\\\\\n \\\\end{aligned}\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"For importance sampling to work, it is critical that \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q(z)>0\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" whenever \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(z\\\\mid \\\\breve{x})>0\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" (we often say that \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is \"] [:em [:<> \"absolutely continuous\"]] [:<> \" with respect to \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \").\"]] [:p [:<> \"The proof above assumed that we can evaluate the density \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(z\\\\mid \\\\breve{x})\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"exactly. However, in general, for a posterior distribution such as this, we\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"do not know this density exactly (if we did, we could probably sample from it\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"efficiently). What happens when we don't have access to this density, but\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"instead have access to a different density that is proportional to $p(z\\\\mid\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"\\\\breve{x})$ such as the joint \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(\\\\breve{x},z)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" (because $p(z\\\\mid \\\\breve{x}) =\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"\\\\frac{p(\\\\breve{x},z)}{p(\\\\breve{x})}$)?\"]] [:p [:<> \"A natural idea would be to use the joint probability \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(\\\\breve{x},z)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" in the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"numerator of our importance weight. Let's call the new weight function the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:em [:<> \"unnormalized importance function\"]] [:<> \" \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"w^*(z)=\\\\frac{p(\\\\breve{x},z)}{q(z)}\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \".\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\begin{aligned}\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)]    &= \\\\sum_{z} p(z\\\\mid \\\\breve{x}) f(z)\\\\\\\\\\n                                   &= \\\\sum_{z} q(z) \\\\frac{p(z\\\\mid \\\\breve{x})}{q(z)}f(z)\\\\\\\\\\n                                   &= \\\\sum_{z} q(z) \\\\frac{p(\\\\breve{x}, z)/p(\\\\breve{x})}{q(z)}f(z)\\\\\\\\\\n                                   &= \\\\sum_{z} q(z) \\\\frac{p(\\\\breve{x}, z)}{p(\\\\breve{x})q(z)}f(z)\\\\\\\\\\n                                    &= \\\\sum_{z} q(z) \\\\frac{1}{p(\\\\breve{x})}\\\\frac{p(\\\\breve{x}, z)}{q(z)}f(z)\\\\\\\\\\n                                   &= \\\\sum_{z} q(z) \\\\frac{1}{p(\\\\breve{x})}w^*(z)f(z)\\\\\\\\\\n                                   &= \\\\sum_{z} q(x) \\\\frac{1}{p(\\\\breve{x})}g(z), \\\\quad g(z) = w^*(z)f(z) = \\\\frac{p(x, z)}{q(z)}f(z) \\\\\\\\\\n                                   &= \\\\mathbb{E}_{q(z)} \\\\left[ \\\\frac{1}{p(\\\\breve{x})} g(z)\\\\right ]\\\\\\\\\\n \\\\mathbb{E}_{p(z\\\\mid x)} [f(z)]    &= \\\\frac{1}{p(\\\\breve{x})}\\\\mathbb{E}_{q(z)} \\\\left[  g(z)\\\\right ]\\\\\\\\\\n p(\\\\breve{x})\\\\mathbb{E}_{p(z\\\\mid x)} [f(z)]&= \\\\mathbb{E}_{q(z)} \\\\left[  g(z)\\\\right ]\\\\\\\\\\n                                   &\\\\approx \\\\frac{1}{K}\\\\sum_{i=1}^{K} g(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n                                   &\\\\approx \\\\frac{1}{K}\\\\sum_{i=1}^{K} w^*(z)f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n                                   &\\\\approx \\\\frac{1}{K}\\\\sum_{i=1}^{K}\\\\frac{p(\\\\breve{x}, z)}{q(\\\\hat{z}_i)} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n \\\\end{aligned}\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"So now we have a problem. By using an unnormalized version of our target\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"distribution \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" in our modified unnormalized importance weight function\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"w^*(\\\\cdot)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" our importance sampling approximator does not give us the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"correct expectation, but rather an expectation which is off by a factor of\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \"—the marginal likelihood. In order to correct this problem, we\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"need to divide both sides by the marginal likelihood. But, of course, we\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"don't know the marginal likelihood, if we did, we wouldn't need to use\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"importance sampling in the first place!!\"]] [:p [:<> \"So, how can we correct this issue? There is an important fact about our\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"importance weights which can come to the rescue. Let's see how their\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"expectation behaves with respect to the proposal distribution \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \".\"]] [:p [:<> \"However, let's look at the expectation of our importance weight with\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"unnormalized target density such as the joint \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x, z)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \".\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \" \\\\begin{aligned}\\n \\\\mathbb{E}_{q(z)}\\\\left [w^*(z)\\\\right] &= \\\\mathbb{E}_{q(z)}\\\\left [\\\\frac{p(\\\\breve{x}, z)}{q(z)} \\\\right]\\\\\\\\\\n &=\\\\mathbb{E}_{q(z)}\\\\left [\\\\frac{p(\\\\breve{x}, z)}{q(z)} \\\\right]\\\\\\\\\\n &=\\\\sum_{z} q(z) \\\\frac{p(\\\\breve{x}, z)}{q(z)}\\\\\\\\\\n &=\\\\sum_{z} p(\\\\breve{x}, z)\\\\\\\\\\n &= p(\\\\breve{x})\\\\\\\\\\n \\\\end{aligned}\\n \", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"Thus, we can estimate our marginal likelihood \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x)\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" by averaging our\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"importance weights.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \" \\\\begin{aligned}\\n p(x) &= \\\\mathbb{E}_{q(z)}\\\\left [w^*(z)\\\\right]\\\\\\\\\\n &\\\\approx \\\\frac{1}{K} \\\\sum_{i=1}^{K}  w^*(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n &\\\\approx \\\\frac{1}{K} \\\\sum_{i=1}^{K}  \\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}, \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n \\\\end{aligned}\\n \", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"This suggests that we can use monte carlo to correct the problem above.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\begin{aligned}\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)]  &= \\\\sum_{z} p(z\\\\mid \\\\breve{x}) f(z)\\\\\\\\\\n                                 &= \\\\sum_{z} q(z) \\\\frac{p(z\\\\mid x)}{q(z)}f(z)\\\\\\\\\\n                                 &= \\\\sum_{z} q(z) \\\\frac{p(\\\\breve{x},z)/p(x)}{q(z)}f(z)\\\\\\\\\\n                                 &= \\\\sum_{z} q(z) \\\\frac{1}{p(\\\\breve{x})}g(z), \\\\quad g(z) = w^*(z)f(z) = \\\\frac{p(\\\\breve{x}, z)}{q(z)}f(z) \\\\\\\\\\n                                 &= \\\\mathbb{E}_{q(z)} \\\\left[ \\\\frac{1}{p(\\\\breve{x})} g(z)\\\\right ] \\\\\\\\\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)]  &= \\\\frac{1}{p(\\\\breve{x})}\\\\mathbb{E}_{q(z)} \\\\left[  g(z)\\\\right ]\\\\\\\\\\n                                 &= \\\\frac{1}{\\\\mathbb{E}_{q(z)}[w^*(z)]}\\\\mathbb{E}_{q(z)} \\\\left[  g(z)\\\\right ]\\\\\\\\\\n                                 &\\\\approx  \\\\frac{1}{\\\\frac{1}{K}\\\\sum_{i=1}^{K} w^*(\\\\hat{z}_i)}  \\\\frac{1}{K}\\\\sum_{i=1}^{K}g(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n                                 &\\\\approx  \\\\frac{1}{\\\\sum_{i=1}^{K} w^*(\\\\hat{z}_i)}\\\\sum_{i=1}^{K}g(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n                                 &\\\\approx  \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}}  \\\\sum_{i=1}^{K}\\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n                                 &\\\\approx  \\\\sum_{i=1}^{K}\\\\frac{\\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}}f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n \\\\end{aligned}\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\frac{\\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}}\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is called the \"] [:em [:<> \"self-normalized importance weight\"]] [:<> \".  Note that, of course and critically, we must be able to sample from \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\hat{z}_i \\\\sim q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \". Also note that we are now estimating our original expectation as the ratio of two estimators. The ratio of two unbiased estimators is biased and, in practice, will tend to underestimate the true quantity.\"]] [:p [:<> \"Let's look at some examples of importance sampling.\"]] [\"h2\" {:id \"exact-sampling-from-the-posterior\"} [:<> \"Exact Sampling from the Posterior\"]] [:p [:<> \"What if we can take exact samples from our posterior distribution?\"]] [:p [:<> \"In this case \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" is equal to our exact posterior \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \". Using the normalized\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"form of importanc sampling, we get\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \" \\\\begin{aligned}\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)]\\n &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\hat{z}_i \\\\mid \\\\breve{x})p(\\\\breve{x})}{p(\\\\hat{z}_i\\\\mid \\\\breve{x})}} \\\\sum_{i=1}^{K}\\\\frac{p(\\\\hat{z}_i\\\\mid \\\\breve{x})p(\\\\breve{x})}{p(\\\\hat{z}_i\\\\mid \\\\breve{x})} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z\\\\mid \\\\breve{x})\\\\\\\\\\n &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} p(\\\\breve{x})} \\\\sum_{i=1}^{K} p(\\\\breve{x})f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z\\\\mid \\\\breve{x})\\\\\\\\\\n &\\\\approx \\\\frac{p(\\\\breve{x})}{p(\\\\breve{x})\\\\sum_{i=1}^{K} 1} \\\\sum_{i=1}^{K} 1 f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z\\\\mid \\\\breve{x})\\\\\\\\\\n &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} 1} \\\\sum_{i=1}^{K} 1 f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z\\\\mid \\\\breve{x})\\\\\\\\\\n &\\\\approx \\\\frac{1}{K} \\\\sum_{i=1}^{K} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z\\\\mid \\\\breve{x})\\\\\\\\\\n \\\\end{aligned}.\\n \", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"So in this case, our importance sampling principle just reduces to the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"standard Monte Carlo approximation.\"]] [\"h2\" {:id \"rejection-sampling\"} [:<> \"Rejection Sampling\"]] [:p [:<> \"In this case, our target posterior \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" cannot be evaluated. However, we can\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"evaluate the joint distribution, which we can write as the product of the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"likelihood and prior. We take samples from this joint, so our proposal here\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"is over both our latent variables \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"z\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" \"] [:strong [:<> \"and\"]] [:<> \" our observed variables \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"x\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \". We\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"can write this proposal like this\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q(x,z)=p(x\\\\mid z)p(z).\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"The score of each sample under the true posterior is proportional to $p(x\\\\mid\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"z)p(z)$ for samples which satisfy the conditioner \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\breve{x}\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" but it is \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"0\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"otherwise. Thus, each sample \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"x\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" has posterior probability proportional to\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"our target distribution:\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(x\\\\mid z)p(z)\\\\mathbb{1}_{\\\\breve{x}}(x)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"So,\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \" \\\\begin{aligned}\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)] &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\hat{x}_i\\\\mid \\\\hat{z}_i)p(\\\\hat{z}_i)\\\\mathbb{1}_{\\\\breve{x}}(\\\\hat{x}_i)}{p(\\\\hat{x}_i\\\\mid \\\\hat{z}_i)p(\\\\hat{z}_i)}} \\\\sum_{i=1}^{K}  \\\\frac{p(\\\\hat{x}_i\\\\mid \\\\hat{z}_i)p(\\\\hat{z}_i)\\\\mathbb{1}_{\\\\breve{x}}(\\\\hat{x}_i)}{p(\\\\hat{x}_i\\\\mid \\\\hat{z}_i)p(\\\\hat{z}_i)} f(\\\\hat{z}_i), \\\\quad \\\\hat{x}_i, \\\\hat{z}_i \\\\sim p(x\\\\mid z)p(z)\\\\\\\\\\n &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\mathbb{1}_{\\\\breve{x}}(\\\\hat{x}_i)} \\\\sum_{i=1}^{K}  \\\\mathbb{1}_{\\\\breve{x}}(\\\\hat{x}_i) f(\\\\hat{z}_i), \\\\quad \\\\hat{x}_i, \\\\hat{z}_i \\\\sim p(x\\\\mid z)p(z)\\\\\\\\\\n \\\\end{aligned}\\n \", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}]] [\"h2\" {:id \"likelihood-weighting-2\"} [:<> \"Likelihood Weighting\"]] [:p [:<> \"In this case, as in rejection sampling, our target posterior \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" cannot be\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"evaluated, but we can evaluate the joint distribution. We force our samples\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"to take on the desired values in the likelihood, so our our proposal is just\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"the prior distribution:\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q(z)=p(z)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"The score of each sample under the true posterior is proportional to $p(x\\\\mid\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"z)p(z)$ for all samples (since we are forcing the conditioner to be\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"satisfied) so our target distribution is:\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p(\\\\breve{x}\\\\mid z)p(z)\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}] [:p [:<> \"So,\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \" \\\\begin{aligned}\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)] &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\breve{x}\\\\mid \\\\hat{z}_i)p(\\\\hat{z}_i)}{p(\\\\hat{z}_i)}} \\\\sum_{i=1}^{K}  \\\\frac{p(\\\\breve{x}\\\\mid \\\\hat{z}_i)p(\\\\hat{z}_i)}{p(\\\\hat{z}_i)} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z)\\\\\\\\\\n &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} p(\\\\breve{x} \\\\mid \\\\hat{z}_i)} \\\\sum_{i=1}^{K}  p(\\\\breve{x} \\\\mid \\\\hat{z}_i) f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim p(z)\\\\\\\\\\n \\\\end{aligned}\\n \", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}]] [\"h1\" {:id \"importance-resampling\"} [:<> \"Importance Resampling\"]] [:p [:em [:<> \"Importance sampling\"]] [:<> \" isn't really an inference algorithm, rather it is more\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"a framework for thinking about how to mathematically relate samples from one\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"distribution to another distribution by taking samples from a proposal\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"distribution \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \" and assigning them weights \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"p/q\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \". How can we use importance\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"sampling to generate samples (approximately) from our target distribution?\"]] [:p [:<> \"One idea is known as \"] [:em [:<> \"importance resampling\"]] [:<> \". Our importance weights tell us\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"how to upweight or downweight our samples to make them match our target\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"distribution. We can approximate the true distribution my renormalizing these\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"weights and sampling a trace from them.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:div.code-viewer.code-listing [#viewer-eval nextjournal.clerk.render/inspect-presented {:path [0], :nextjournal/value \"function my_importance_resampling(model,arguments,constraints,computation)\\n    samples=[Gen.generate(model,arguments,constraints) for i=1:computation]\\n    traces = [item[1] for item in samples]\\n    weights = [item[2] for item in samples]\\n\\n    weight_sum=logsumexp(weights)\\n    normed_ws=weights.-weight_sum\\n\\n    average_weight=weight_sum-log(length(weights))\\n    result=traces[categorical(exp.(normed_ws))]\\n    (result, average_weight)\\nend\\n\\nobservations = Gen.choicemap()\\n\\nnum=100\\nfor i in 1:num\\n    observations[:x => i] = true\\nend\\n\\nss=[my_importance_resampling(flip_biased_coin,\\n                             (num+1,),\\n                             observations,\\n                             500)\\n    for _ in 1:1000]\\n\\nθs = [x[1][:θ] for x in ss]\\nhistogram(θs)\", :nextjournal/render-opts {:language \"julia\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code, :hash \"5dsJQw12yyyd7TcZEf52VSHxnqnJUC\"}}]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:p [:<> \"One way to view importance resampling is as an estimator for posterior\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"probabilities by considering the function that we are taking expecatations\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB\"}}] [:<> \"of (usually \"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"f\", :nextjournal/viewer {:name :nextjournal.markdown/formula, :render-fn #viewer-fn (fn [tex] (nextjournal.clerk.render/render-katex tex {:inline? true})), :hash \"5dt6DiPBjaZbeXfXmhPfzC4UAAhKDu\"}}] [:<> \") to be the indicator function at each sampled datapoint.\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value \"\\\\begin{aligned}\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [f(z)] &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}}  \\\\sum_{i=1}^{K}\\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)} f(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q \\\\\\\\\\n \\\\mathbb{E}_{p(z\\\\mid \\\\breve{x})} [\\\\mathbb{1}_{z^\\\\prime}(z)] = p(z^\\\\prime\\\\mid \\\\breve{x})  &\\\\approx \\\\frac{1}{\\\\sum_{i=1}^{K} \\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)}}  \\\\sum_{i=1}^{K}\\\\frac{p(\\\\breve{x}, \\\\hat{z}_i)}{q(\\\\hat{z}_i)} \\\\mathbb{1}_{z^\\\\prime}(\\\\hat{z}_i), \\\\quad \\\\hat{z}_i \\\\sim q\\\\\\\\\\n \\\\end{aligned}\", :nextjournal/viewer {:name :nextjournal.markdown/block-formula, :render-fn #viewer-fn nextjournal.clerk.render/render-katex, :hash \"5dtLYB93Mi3NowoYurf1Ue76yrXtDC\"}}]], :nextjournal/render-opts {:id \"user/markdown-5drS52iqmwKWuJufpdQudLwPbHwFDq\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn identity, :hash \"5dsg4Bx9A9L7WvvCgamUoRtxUsmYCe\"}}]}, :nextjournal/viewer {:name nextjournal.clerk.viewer/notebook-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-notebook, :hash \"5duAFDxE4sCnRX71Wo6zeCpC9C3djE\"}}}, :path->url {\"notebooks/lectures/genlite.clj\" \"notebooks/lectures/genlite.html\", \"notebooks/lectures/smc.clj\" \"notebooks/lectures/smc.html\", \"notebooks/lectures/importance.clj\" \"notebooks/lectures/importance.html\", \"notebooks/lectures/inference.clj\" \"notebooks/lectures/inference.html\", \"notebooks/lectures/simulation.clj\" \"notebooks/lectures/simulation.html\", \"notebooks/lectures/mcmc.clj\" \"notebooks/lectures/mcmc.html\", \"notebooks/lectures/face.clj\" \"notebooks/lectures/face.html\", \"file:/Users/sritchie/.gitlibs/libs/io.github.nextjournal/clerk/d80187013d7b7b96db3d8b114b8d99f687170668/src/nextjournal/clerk/index.clj\" \"\"}, :current-path \"notebooks/lectures/importance.clj\", :resource->url {\"/js/viewer.js\" \"https://cas.clerk.garden/tree/8VxCcd2nQqrhPLVttyyM5Rnv8qMYcjeSEjgJnhZTvCgVhmgsNWWeusxmVkfX9ajrXmFqQEdVmtdHSoCdHLG2XTsXXB/.clerk/shadow-cljs/main.js\"}, :index \"file:/Users/sritchie/.gitlibs/libs/io.github.nextjournal/clerk/d80187013d7b7b96db3d8b114b8d99f687170668/src/nextjournal/clerk/index.clj\"}".replaceAll('nextjournal.clerk.view/escape-closing-script-tag', 'script')
viewer.init(viewer.read_string(state))
</script></body></html>